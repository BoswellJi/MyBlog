import{_ as s,c as a,b as t,o as e}from"./app-DUVHEK3E.js";const p={};function l(i,n){return e(),a("div",null,[...n[0]||(n[0]=[t(`<h1 id="h3-框架技术分享" tabindex="-1"><a class="header-anchor" href="#h3-框架技术分享"><span>H3 框架技术分享</span></a></h1><h2 id="什么是-h3" tabindex="-1"><a class="header-anchor" href="#什么是-h3"><span>什么是 H3？</span></a></h2><p>是一个轻量级、快速、可组合、可移植的服务器端框架，用于现代JavaScript运行时（如 Node.js、Cloudflare Workers、Vercel Edge、Deno，Bun 等）。提供了极简的 API 和跨运行时的兼容性，使得开发者能够轻松构建高性能的服务端应用。</p><h2 id="核心特性" tabindex="-1"><a class="header-anchor" href="#核心特性"><span>核心特性</span></a></h2><ul><li><strong>跨运行时支持</strong>：一套代码，适配多种 JavaScript 运行时环境。</li><li><strong>尺寸小并且支持 Tree-shakable</strong>: H3核心是超轻量级的，并且是可摇树的，只有你使用的东西才会包含在最终的包中。</li><li><strong>可组合</strong>：扩展服务器并添加功能。您的代码库将随着项目的扩展而扩展。</li><li><strong>快速路由器</strong>: 使用unjs/radix3的超快速路由匹配。</li><li><strong>兼容Web标准</strong>：优雅的最小API实现与web标准兼容的HTTP处理程序。</li><li><strong>兼容Express/Connect框架的中间件</strong>：node/connect/express中间件的兼容层。</li><li><strong>类型安全</strong>：使用TypeScript编写，提供完整的类型定义。</li><li><strong>实时通信支持</strong>：H3内置了跨平台的WebSocket和SSE支持。</li></ul><h2 id="为什么选择-h3-对比-express-koa" tabindex="-1"><a class="header-anchor" href="#为什么选择-h3-对比-express-koa"><span>为什么选择 H3？（对比 Express/Koa）</span></a></h2><table><thead><tr><th>维度</th><th>H3</th><th>Express/Koa</th></tr></thead><tbody><tr><td>运行时支持</td><td>Node.js/Cloudflare Workers/Vercel Edge/Deno 等</td><td>仅 Node.js</td></tr><tr><td>体积</td><td>无依赖少，轻量</td><td>依赖众多，体积较大</td></tr><tr><td>边缘计算适配</td><td>原生支持，极致优化</td><td>不支持，需重写适配</td></tr><tr><td>核心场景</td><td>边缘 API、轻量微服务</td><td>传统 Node.js 后端、大型单体服务</td></tr></tbody></table><h2 id="h3-的核心设计理念" tabindex="-1"><a class="header-anchor" href="#h3-的核心设计理念"><span>H3 的核心设计理念</span></a></h2><ul><li><strong>去运行时锁定</strong>：一套代码，适配所有 JS 运行时；</li><li><strong>极简 API</strong>：降低学习成本，聚焦业务开发；</li><li><strong>安全优先</strong>：内置请求校验、错误标准化等基础安全能力；</li><li><strong>性能优化</strong>：基于 Fetch API 设计，异步性能拉满。</li></ul><hr><h2 id="h3-核心基础" tabindex="-1"><a class="header-anchor" href="#h3-核心基础"><span>H3 核心基础</span></a></h2><h4 id="核心概念" tabindex="-1"><a class="header-anchor" href="#核心概念"><span>核心概念</span></a></h4><ul><li><strong>事件驱动模型</strong>：以 <code>Event</code> 为核心，封装请求/响应上下文；</li><li><strong>洋葱模型中间件</strong>：支持前置拦截、后置处理，与 Koa 一脉相承；</li><li><strong>处理器（Handler）</strong>：核心执行单元，对应单个路由的业务逻辑。</li></ul><h4 id="核心模块" tabindex="-1"><a class="header-anchor" href="#核心模块"><span>核心模块</span></a></h4><h5 id="逻辑处理-controller" tabindex="-1"><a class="header-anchor" href="#逻辑处理-controller"><span>逻辑处理（Controller）</span></a></h5><ul><li><code>defineEventHandler</code>：定义 H3 处理器（核心入口）。</li><li>入参：<code>event</code>（请求上下文）。</li><li>出参：支持直接返回 JSON/字符串/流，自动序列化。</li></ul><h5 id="请求解析" tabindex="-1"><a class="header-anchor" href="#请求解析"><span>请求解析</span></a></h5><ul><li><code>getQuery</code>：获取 URL 查询参数；</li><li><code>readBody</code>：解析 POST/PUT 请求体（支持 JSON/表单/FormData）；</li><li><code>getHeader</code>/<code>getHeaders</code>：获取请求头；</li><li><code>getRouterParams</code>：获取动态路由参数。</li></ul><h5 id="响应控制" tabindex="-1"><a class="header-anchor" href="#响应控制"><span>响应控制</span></a></h5><ul><li><code>setHeader</code>/<code>setHeaders</code>：设置响应头；</li><li><code>sendRedirect</code>：页面重定向；</li><li><code>sendError</code>：发送标准化错误响应；</li><li><code>createError</code>：创建符合 H3 规范的错误对象。</li></ul><h5 id="编写第一个-h3-服务" tabindex="-1"><a class="header-anchor" href="#编写第一个-h3-服务"><span>编写第一个 H3 服务</span></a></h5><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createApp<span class="token punctuation">,</span> createRouter<span class="token punctuation">,</span> defineEventHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;h3&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">createRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function">defineEventHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">&quot;⚡️ Tadaa!&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 运行 H3 服务</span></span>
<span class="line">listhen <span class="token parameter variable">-w</span> ./h3/index.ts</span>
<span class="line"><span class="token comment"># 访问 http://localhost:3000/，返回 {&quot;message&quot;:&quot;⚡️ Tadaa!&quot;}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="h3-路由开发" tabindex="-1"><a class="header-anchor" href="#h3-路由开发"><span>H3 路由开发</span></a></h2><ul><li><strong>路由定义</strong>：基于 HTTP 方法（GET/POST/PUT/DELETE）和路径定义；</li></ul><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// 基础写法</span></span>
<span class="line">router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token string">&quot;/hello&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function">defineEventHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token string">&quot;Hello world!&quot;</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 链式写法</span></span>
<span class="line">router</span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token string">&quot;/hello&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">defineEventHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token string">&quot;GET Hello world!&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token string">&quot;/hello&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">defineEventHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token string">&quot;POST Hello world!&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>动态路由</strong>：支持路径参数（如 <code>/users/:id</code>）和通配符（如 <code>/files/*</code>）；</li></ul><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line">router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token string">&quot;/hello/:name&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function">defineEventHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>event<span class="token punctuation">.</span>context<span class="token punctuation">.</span>params<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>路由嵌套</strong>：支持路由分组和嵌套，提升代码组织性。</li></ul><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createApp<span class="token punctuation">,</span> createRouter<span class="token punctuation">,</span> defineEventHandler<span class="token punctuation">,</span> useBase <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;h3&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> websiteRouter <span class="token operator">=</span> <span class="token function">createRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function">defineEventHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token string">&quot;Hello world!&quot;</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> apiRouter <span class="token operator">=</span> <span class="token function">createRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token string">&quot;/hello&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function">defineEventHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token string">&quot;Hello API!&quot;</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">websiteRouter<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;/api/**&quot;</span><span class="token punctuation">,</span> <span class="token function">useBase</span><span class="token punctuation">(</span><span class="token string">&quot;/api&quot;</span><span class="token punctuation">,</span> apiRouter<span class="token punctuation">.</span>handler<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>websiteRouter<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="h3-中间件开发" tabindex="-1"><a class="header-anchor" href="#h3-中间件开发"><span>H3 中间件开发</span></a></h2><ul><li><strong>中间件类型</strong>：全局中间件、路由级中间件；</li><li><strong>核心写法</strong>：</li></ul><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// 全局鉴权中间件</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token function">defineEventHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span>event<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 前置拦截：校验 Token</span></span>
<span class="line">    <span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token function">getHeader</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token string">&#39;authorization&#39;</span><span class="token punctuation">)</span><span class="token operator">?.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&#39;Bearer &#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">sendError</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token function">createError</span><span class="token punctuation">(</span><span class="token punctuation">{</span> statusCode<span class="token operator">:</span> <span class="token number">401</span><span class="token punctuation">,</span> statusMessage<span class="token operator">:</span> <span class="token string">&#39;未授权&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">// 挂载数据到 event，供后续处理器使用</span></span>
<span class="line">    event<span class="token punctuation">.</span>context<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">&#39;1&#39;</span><span class="token punctuation">,</span> username<span class="token operator">:</span> <span class="token string">&#39;test&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// 执行下一个中间件/处理器</span></span>
<span class="line">    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// 后置处理：添加响应头</span></span>
<span class="line">    <span class="token function">setHeader</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token string">&#39;X-Request-Id&#39;</span><span class="token punctuation">,</span> crypto<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 路由级中间件</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token string">&quot;/abc&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function">defineEventHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token string">&quot;First&quot;</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 懒加载中间件</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;/abc&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;./big-handler&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> lazy<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>执行顺序</strong>：全局中间件 → 路由级中间件 → 处理器。</li></ul><hr><h2 id="h3-utils-工具函数" tabindex="-1"><a class="header-anchor" href="#h3-utils-工具函数"><span>H3 Utils 工具函数</span></a></h2><h4 id="与传统的插件-中间件方法相比-可组合程序具有巨大的优势" tabindex="-1"><a class="header-anchor" href="#与传统的插件-中间件方法相比-可组合程序具有巨大的优势"><span>与传统的插件/中间件方法相比，可组合程序具有巨大的优势：</span></a></h4><ul><li>✅您的服务器只包含并运行所需的代码</li><li>✅您可以轻松扩展服务器功能，而无需添加全局插件</li><li>✅使用清晰明了，少了全局中间件和插件</li><li>✅更好的性能和更小的内存占用，因为没有不必要的代码被加载或执行</li></ul><h4 id="h3-utils-是一套实用工具函数-旨在简化-h3-开发中的常见任务。它提供了以下核心功能" tabindex="-1"><a class="header-anchor" href="#h3-utils-是一套实用工具函数-旨在简化-h3-开发中的常见任务。它提供了以下核心功能"><span>H3 Utils 是一套实用工具函数，旨在简化 H3 开发中的常见任务。它提供了以下核心功能：</span></a></h4><ul><li>请求数据处理</li><li>响应控制</li><li>错误处理</li><li>Session</li><li>Cookie</li><li>CORS</li><li>Route</li><li>Proxy</li><li>等等</li></ul><hr><h2 id="h3-适配器" tabindex="-1"><a class="header-anchor" href="#h3-适配器"><span>H3 适配器</span></a></h2><h4 id="使用适配器在任何地方运行h3-夸运行时部署" tabindex="-1"><a class="header-anchor" href="#使用适配器在任何地方运行h3-夸运行时部署"><span>使用适配器在任何地方运行h3,夸运行时部署</span></a></h4><ul><li>Node.js</li><li>Bun</li><li>Deno</li><li>Cloudflare Workers</li></ul><hr><h2 id="h3运行机制" tabindex="-1"><a class="header-anchor" href="#h3运行机制"><span>H3运行机制</span></a></h2><p>H3 基于 <strong>Web Fetch API</strong> 的请求/响应模型，核心是 <code>H3Event</code>（请求上下文）。<br> 一次请求从进入到返回，大致经历以下阶段：</p><ol><li><p><strong>请求进入</strong></p><ul><li>运行时（Node/Bun/Deno/Workers）接收 HTTP 请求；</li><li>H3 创建 <code>H3Event</code>，封装 <code>req</code>、<code>res</code>、<code>context</code> 等上下文。</li></ul></li><li><p><strong>全局中间件执行</strong></p><ul><li>按注册顺序执行；</li><li>常用于日志、鉴权、限流、CORS、上下文注入。</li></ul></li><li><p><strong>路由匹配</strong></p><ul><li>根据请求方法和路径进行匹配（支持动态路由和通配符）；</li><li>命中后进入对应路由链路。</li></ul></li><li><p><strong>路由级中间件</strong></p><ul><li>仅对命中的路由生效；</li><li>适合做模块级校验（如 <code>/api/admin/**</code> 权限控制）。</li></ul></li><li><p><strong>处理器执行</strong></p><ul><li>执行业务逻辑并返回结果；</li><li>可返回 JSON、字符串、<code>Response</code>、流等；</li><li>H3 会按返回值类型进行响应封装与序列化。</li></ul></li><li><p><strong>响应输出</strong></p><ul><li>写入状态码、响应头、响应体并返回客户端；</li><li>若有“后置逻辑”（洋葱模型中的 next 之后代码），会在响应前完成。</li></ul></li><li><p><strong>错误处理</strong></p><ul><li>任一阶段抛错会进入统一错误处理流程；</li><li>推荐使用 <code>createError</code> + <code>sendError</code> 生成标准化错误响应；</li><li>未捕获异常会被转换为规范错误输出，避免泄露内部细节。</li></ul></li></ol>`,48)])])}const c=s(p,[["render",l]]),u=JSON.parse('{"path":"/nuxt/h3/","title":"H3 框架技术分享","lang":"en-US","frontmatter":{},"git":{"updatedTime":1772120639000,"contributors":[{"name":"mingzhuang.ji","username":"","email":"mingzhuang.ji@ly.com","commits":1},{"name":"Boswell","username":"Boswell","email":"aiyoudqrjmz@163.com","commits":1,"url":"https://github.com/Boswell"}],"changelog":[{"hash":"ed046a2d3a561a69776622616c878197e75f67a1","time":1772120639000,"email":"aiyoudqrjmz@163.com","author":"Boswell","message":"feat(blog): h3框架分享大纲"},{"hash":"6f65033009142e67ff602dd17852d162139554ca","time":1772108939000,"email":"mingzhuang.ji@ly.com","author":"mingzhuang.ji","message":"feat(blog): h3框架分享大纲"}]},"filePathRelative":"nuxt/h3/index.md"}');export{c as comp,u as data};
